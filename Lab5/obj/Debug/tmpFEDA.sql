DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Lab5.Models.ApplicationDbContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201504090236138_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[IdentityConfigurations] (
        [Id] [int] NOT NULL IDENTITY,
        [MaxFailedAccessAttemptsBeforeLockout] [int] NOT NULL,
        [DefaultAccountLockoutTimeSpan] [time](7) NOT NULL,
        [RequiredLength] [int] NOT NULL,
        [RequireNonLetterOrDigit] [bit] NOT NULL,
        [RequireDigit] [bit] NOT NULL,
        [RequireLowercase] [bit] NOT NULL,
        [RequireUppercase] [bit] NOT NULL,
        [CannotReusePassword] [bit] NOT NULL,
        CONSTRAINT [PK_dbo.IdentityConfigurations] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        [IdentityUser_Id] [nvarchar](128),
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE INDEX [IX_IdentityUser_Id] ON [dbo].[AspNetUserRoles]([IdentityUser_Id])
    CREATE TABLE [dbo].[Users] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](max),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](max),
        CONSTRAINT [PK_dbo.Users] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](max),
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        [IdentityUser_Id] [nvarchar](128),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_IdentityUser_Id] ON [dbo].[AspNetUserClaims]([IdentityUser_Id])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        [IdentityUser_Id] [nvarchar](128),
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_IdentityUser_Id] ON [dbo].[AspNetUserLogins]([IdentityUser_Id])
    CREATE TABLE [dbo].[OldPasswords] (
        [HashPassword] [nvarchar](128) NOT NULL,
        [UserID] [nvarchar](128) NOT NULL,
        [CreatedDate] [datetimeoffset](7) NOT NULL,
        [AppUser_Id] [nvarchar](128),
        CONSTRAINT [PK_dbo.OldPasswords] PRIMARY KEY ([HashPassword], [UserID])
    )
    CREATE INDEX [IX_AppUser_Id] ON [dbo].[OldPasswords]([AppUser_Id])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [LockoutCount] [int] NOT NULL,
        [HashingVersion] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Id] ON [dbo].[AspNetUsers]([Id])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.Users_IdentityUser_Id] FOREIGN KEY ([IdentityUser_Id]) REFERENCES [dbo].[Users] ([Id])
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.Users_IdentityUser_Id] FOREIGN KEY ([IdentityUser_Id]) REFERENCES [dbo].[Users] ([Id])
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.Users_IdentityUser_Id] FOREIGN KEY ([IdentityUser_Id]) REFERENCES [dbo].[Users] ([Id])
    ALTER TABLE [dbo].[OldPasswords] ADD CONSTRAINT [FK_dbo.OldPasswords_dbo.AspNetUsers_AppUser_Id] FOREIGN KEY ([AppUser_Id]) REFERENCES [dbo].[AspNetUsers] ([Id])
    ALTER TABLE [dbo].[AspNetUsers] ADD CONSTRAINT [FK_dbo.AspNetUsers_dbo.Users_Id] FOREIGN KEY ([Id]) REFERENCES [dbo].[Users] ([Id])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201504090236138_InitialCreate', N'Lab5.Models.ApplicationDbContext',  0x1F8B0800000000000400DD5DDB6EE338127D5F60FF41F0D3CC2263E7B2DDDB1B383348DBC96E30B9214E06FB163012ED08AD8B5B97EE048BF9B27DD84FDA5F5852A224DE4549B4E30C0668C42279AA582C5695C852CDFFFEF3DFE92F2F61E07C8349EAC7D1C9E860BC3F7260E4C69E1FAD4E4679B6FCE9D3E8979FFFFCA7E99917BE38BF55FD8E703F34324A4F46CF59B63E9E4C52F71986201D87BE9BC469BCCCC66E1C4E80174F0EF7F7FF3E39389840043142588E33BDCBA3CC0F61F103FD9CC5910BD7590E82ABD883414A9EA3964581EA5C8310A66BE0C293D12578FA302EBB8D9CD3C0078885050C96230744519C810C3178FC90C24596C4D16AB1460F4070FFBA86A8DF120429248C1F37DD4DE7B07F88E730690656506E9E6671D811F0E0880865C20FEF25DA512D3424B63324DEEC15CFBA10DDC9E8C283C52324E9A5BFCA134287A77C3C0B123C8A11F3583A78CFC15DF66A9D40AA83FFDB73667990E5093C89609E2520D8736EF3A7C0777F85AFF7F117189D447910D0CC2276511BF3003DBA4DE2354CB2D73BB8ACA7307226ECB8093FB01E468D29E7731165478723E71A11074F01AC75819AFB228B13F80F18413441E8DD822C8349D4884EA0CED1BA022FE7C00FA077EABA304D4FD1F0709DA59FE112C15EC6EE9738CFDAB8D15398C32540C245F831DA3F04F21EED23A4E551058D7F7746BE835F733F81DE258C56D9F3302E09D6751C5D422CC29B64EEAFFC7AEA9FE3388098DD7EB036B12EE3EF307101EE6F05EF61BDB683372BB4F20EE629BC0569FA3D4EBC6E90D34963018CECC21D42D59983ABDAF49CA6EB6B98D536615C429E27080EF1F9654C23EE39C6E31A4372686A488E0E9E96479F3E7C04DED1C7BFC2A30FDB372AC8C7203F3972D0D62F770EF2A0879F46CEB9FF52EDA57A791E221FB95534284BF2EE1B14FFABA17AF8E1A315AAD7E09BBF2A969EA38F1C6A82FCED1D0C8AD6F4D95F976E9759EF47D2ED3C8943FC9BD5AFB2F57111E7898B27132BBBDC836405B3812A8DA1ECAB7585BAFBAA8D3915D55BDA154FA8CF4EA8486C7B3754FC6E96AEB1C69DAED768F10AD5C212310DABB861C3022AE733F23B441EF4B62C18D20A93C411331C530CF3FCFF04C82E442B3201CDF2A03F8D96A78B75BA09BCC6574AEC14D5FE88245F2E5463A824CDB519AA2C95AC4F65CD069BAA5900FCD0BEAD2A6077DF58ED7A70DF6AE97AAA341FF8E1D5C234B643E93710E4B649F552FECB78E56B5F47FB297F01BBFBCA5FB0891E7FF33D6C940C1C76D519C11BF597C702ED5B8CE36CDB7E9E99E6B6896F27B831DE2E8C7F330B30A8215B3FADC1B140C3AFA98ACEBBAB284BE84D9464BE7DBAB304623F3647FF54C4F1DFF8F0E766B94C71D4D2FB5DAF8E8EEC4451FCFB9E2ED21AEC48ECFB90DD771FEFE50CE32C047EB0F1C0A6A0529C542721EC786C26F1404453B195D938EB0BE8E60952A84506C2F5C6A9DD3EC711BCCEC327AD67B74ECBDAD2DC7F8FCF818BC2FAB3088F1A8C47DE83CFA2C2AA3E642E6F588D01ACB053DE2294370A16DECDB1296B3944B4FD565EBC62E80F0D0BE35FF5134F0DA966E5B121DD47E646741C16E1AD0187553F058765B39E43D2A72B8718C98041D24DC15FD1AA67AFECD2C50D9FA669ECFA055792BB047212CCCE126D2DA7FD58583CC32A4F71AF902BF5F189197A827CD488778C37D11C063083CEA95BDEC1CE40EA024F54583421AF0363F52990FC704DC6DC5F049AC85BC3040F02D837A52816F0A34C74ED7EE4FA6B10B44A891B691816E0B9D734F896395CC308136C95840971F9893266A0A6C32D4A9B84A6134AE3F48A280B52550BAE8D589B1567DEBEDA165B8F2ED127E10099A5B03F1E1FF09BD258183253DBA6FD52BBAB385B6EE5B59542CB062307A35AA1F7950731EC46DCF256DEBE3C381FA1A040CECA36228FD28F1831CB3915FBD2605D527FEBAB94C55995D49221530313F13267FE841BE14B2679AB44C4C98B654AE2227E52187C01335D020E72D98D73E566C765EA083263E14900A0442BE5D402C20B5607D808BF036815E96951C97EEF005B85675A58B26D5A6029832D0364DC40070EDB9813C028951511E9AB76AAA3FA429E77C24681583D9F5ABB04676E143751381205E3633376E20642919E488952698D098CA3026A3EACB668C4A38B0314F2B1211BE96B965A639421827190603A17E398400158CDC5AE842A3BD2222159D0601C360C971017252800ABB9D89510D9B42D02924411A671C470F1B0618325E353BD04D7C142DD369D9429CAE4C174A2C8659E5E81F5DA8F56546E3379E22CCAC4E6D94F8BEE89BF618931715349FE6FCD6D4D298B13B0825C2B228D383DF793349B830C3C15098C332F14BA4943238513AC486AA31F71492B1F590DC77F93B39AB68464C97B29413947930EF19B6D9104205189161C07E7A18300249243F4591CE461A47EE3568F36CB17A6F1CD469873D0924F4C936EE96A4E93CF34A689F06D9D51C59C6309BCD8A9331D35785F442A1559824AB57646A6929225C854AB39B2343D9906977610F1A7136E830A87458241104EF2587363648C54EEA99BED295E7EFA9B1CF9F0CD589AF2DC9F1E5F3ED99915115DF3D0D5A95F4FFBAF901A4225E72A638496B42A0B578D521D9D32BB55719CBA132BD67FB5F873CFEE8B55DEC84BB9504B78D86E62F365691CB6C51C91CF9BA531F936FB1AD0B25E1729FEFB66F9836A9BFD38708F6D6BDD48FA010D401E75C4A06EB00530AACD1C954D32A031D91673442E938086E49A3A7049E70B304CD20DBDF0141295F730A7206608D0E8626B671B40E70A480C01DDDC035BC233DF668E2A4927A08125CDE6D84D6E01EFF97638CE509E73750F34CA13EB61565081B11953682750A192D599E0BF79DC118BA4A30B60E4F94EAA91F230B0BB1A953714C3D44881A1B6354C7E376B6AB449E96A4C26699B31E7BAA475355E37657D2395606E02FA2A037DBBD45D0DB4A375A1A7FC1D5E9FC0DDB25C73C97209B9DD3A1426BF99310874C3F6979F3D2156EA407313D5BAD24DD70E0B8A0FBF398969AE98442919F9940A459EC74371D08F39652A9365451DAEA6DAC9A2C8D4F38B7C8A8B14E764D6599366A2E42F1D3A6B9DF48EAFDDD9D45D3B072592E5D55C09F6D43D06D182026AEE187B73B809456999B75D6DA9EE080DB4A5EADA39F6685B0BF67A7417B585BD6F35E47048606537AC1A1E54BD33AD2677BB064A4D7A763D006E5318E6467B17359AB922DF80C2D838D9DE01A5132EFDF92E75B0499ED4BFEB4B7F72E1DE5ED54CB8812FBB8C9C6A779F8C16AF6906C331EE305E7C0D66810FF1314DD5E10A44FE12A659F95DD9E870FFE090AB8FB63BB5CA2669EA315F959A162C6357700B5FC7F958C4ADB5033A7E8BD3A55258C1C026EA8465C5174DB70974FDB2A6DFDF2C550DEBC3714BCDB027BF37A42D1CA156D8002CA14E581F2C4D8DB076B87EF5C1B6BEFBA26F20719F41227E9D3AA07C56032A24755F441E7C3919FDBB18755C6497E1BF8AC77BC8D73C44FED71C35DC2739747E172B70D995B93CFED8D1E24FD6968AADED64BE5817FF7A2C87EE393709F287C7CE3EB7447DB81182881E6C7118A6FC592AADF28E772DF3C17885FA43085E7ED4CB4981247C79DCC7ECCA3E081FC49AF4A3EF4188920FBB6DE15911A1EAC3ED3E58CA8FB63DF433E34AA19A4C56FE11771FD6941F70F709909ACBD4CE0B3AA01AD91F23DC963BAA5E5B41A8CF351C8DA9C13508EEFDFB2AC909E21FB28296350F792B16C8B286BDA1F8EE7D6AA9F22EEE1D54C3B2AB1173EBB0925A5695F78E492DAB41C714F4E55B0F656B866F41CF94F9ACDB0DDC8DF6A0D5172D5915DA3E8192BC06AD8570C95ABD935D2971D27CC1FDB6954DB659CC44F35980E9C188B37B354C68A3C19415A19F772AC4C07CE7DEB70C4A2FCDD026F4DB570C7DCA95484E9F13B305BDE85BCE6513253A48A58601755B86DA0FC557231BB51FAA6C5F19D1D64BDC6D6B4C8782379BD01852846340659BF7A831AAC4DE77A131E6258136A1306F1DA0BC85BA74088A76415BB88FF81EF16235988FB82621FBC27E1F3FAA5F7306AA964EAF6C8549EF42A1ECC451D6D587CBA8A94E0084FA13FC1A92E42C6D7288712DAD32B7E664E43DC54811CA174145850A519BE49C94A648C940D92CA35BAE93BC1E898A5863FB94049B2E6AA2EA42283AC2AD95AC64041F64355CDA4B8599550AD3CF50512A48479BC4215ADAA48F9EB6A2080F4F9B79AB12A832AD327ABA2A54022DC6D809B49856FDDC44526F51B34C5AE1475697AE25C290A0348DFAC44103216CA446996425854FE2754290689DF0D9C9F0A94BBF39B059824CB976C61AC0981AC537109605B1894A63C305C1D83D457ABF6541D82F28365C0CDBB00843836689C4ACC6E196C5DBC356D9A9C6262660A3E095FA9F4FA3B839F5570D044E2D8FA0CB84AD759F8B6819579133C751D585CFF48519F0504C7B9A64FE12B8196AC6492145E5FDE2E21FA7263D41EF22BAC9B3759EA129C3F02960AEA47114AEA35F949C63799EDEAC8BF0D5C614109B3EBE8EBB893EE77EE0D57C9F4B321C151038BC27F91C782D339CD7B17AAD91AEE3C8108888AF7E2BB987E13A4060E94DB400DF601FDE90EE5DC215705F9B3B7A1548FB42B0629FCE7DB04A4098128C663CFA8974D80B5F7EFE3F4D3A7B9B837D0000 , N'6.1.0-30225')
END

